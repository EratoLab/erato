[package]
name = "erato"
version = "0.1.0"
edition = "2021"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
[[bin]]
name = "gen-openapi"
path = "./src/gen_openapi.rs"

[dependencies]
axum = { version = "0.7.9", features = ["macros"] }
axum-extra = { version = "0.9.6", features = ["typed-header"] }
headers = "0.4.0"
tower-http = { version = "0.6.2" , features = ["fs", "cors"]}
sea-orm = { version = "1.1.4" , features = ["runtime-tokio", "sqlx-postgres"]}
sqlx = { version = "0.8.3", features=["postgres", "runtime-tokio"] }
serde = { version = "1.0.217", features = ["derive"] }
serde_json = "1.0.138"
tokio = { version = "1.43.0", features = ["rt-multi-thread"] }
tracing-subscriber = "0.3.19"
tracing = "0.1.41"
synonym = "0.1.5"
regorus = "0.2.8"
eyre = "0.6.12"
color-eyre = "0.6.3"
async-trait = "0.1.77"
jsonwebtoken = "9.2.0"
# OpenAPI handling
utoipa = { version = "5.3.1", features = ["axum_extras", "uuid", "chrono"] }
utoipa-axum = "0.1.3"
utoipa-swagger-ui = { version = "9.0.0", features = ["axum"] }
utoipa-scalar = { version = "0.2.0", features = ["axum"] }

dotenv-flow = "0.16.2"
config = "0.15.6"
http-body = "1.0.1"
http-body-util = "0.1.2"
lol_html = "2.2.0"
ordered-multimap = "0.7.3"
futures = "0.3"
futures-macro = "0.3"
tokio-stream = "0.1.17"
genai = { version = "0.1.24-WIP", git = "https://github.com/EratoLab/rust-genai.git", rev = "ad7c3a1b70b7629e76719843427652192520a281" }
reqwest = { version = "0.12.12", features = ["multipart"] }

sentry-tracing = { version = "0.35.0", optional = true }
sentry-backtrace = { version = "0.35.0", optional = true }
sentry-tower = { version = "0.35.0", optional = true, features = ["http"] }

[dependencies.sentry]
version = "0.35.0"
optional = true
default-features = false
# Default features, except for `debug-images`; See https://github.com/getsentry/sentry-rust/issues/574
features = ["backtrace", "contexts", "panic", "transport", "reqwest", "native-tls"]

[dev-dependencies]
test-log = "0.2.14"
env_logger = "0.11.2"
pretty_assertions = "1.4.0"
ctor = "0.2.9"
axum-test = "16.4.1"

[patch.crates-io]
# See https://github.com/EratoLab/erato/issues/78
sqlx = { git = "https://github.com/launchbadge/sqlx.git", rev = "a92626d6cc1aef88b0036d633ed370f6f9129c32" }

[features]
default = ["sentry"]
sentry = ["dep:sentry", "dep:sentry-tracing", "dep:sentry-tower", "dep:sentry-backtrace"]

[profile.dev]
split-debuginfo = "packed"

[profile.release]
# Better stack traces in production deployments
debug = "full"
split-debuginfo = "packed"
